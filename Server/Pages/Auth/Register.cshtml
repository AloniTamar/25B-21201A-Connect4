@page
@using Microsoft.AspNetCore.Mvc.Rendering
@model Server.Pages.Auth.RegisterModel
@{
    ViewData["Title"] = "Register";
}
<div class="container mt-4">
    <h2>Register</h2>

    <form method="post" id="registerForm" class="row g-3" novalidate>
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

        <div class="col-md-3">
            <label asp-for="Input.UniqueNumber" class="form-label"></label>
            <input asp-for="Input.UniqueNumber" class="form-control" type="number" min="1" max="1000" required />
            <div class="form-text">Choose a unique number between 1-1000.</div>
            <span asp-validation-for="Input.UniqueNumber" class="text-danger"></span>
        </div>

        <div class="col-md-5">
            <label asp-for="Input.FirstName" class="form-label"></label>
            <input asp-for="Input.FirstName" class="form-control" required />
            <span asp-validation-for="Input.FirstName" class="text-danger"></span>
        </div>

        <div class="col-md-4">
            <label asp-for="Input.Phone" class="form-label"></label>
            <input asp-for="Input.Phone"
                   class="form-control"
                   type="tel"
                   inputmode="numeric"
                   pattern="\d{9,10}"
                   minlength="9"
                   maxlength="10" />
            <span asp-validation-for="Input.Phone" class="text-danger"></span>
        </div>

        <div class="col-md-4">
            <label asp-for="Input.Country" class="form-label"></label>
            <select asp-for="Input.Country" asp-items="Model.CountryOptions" class="form-select" required>
                <option value="">-- Select country --</option>
            </select>
            <span asp-validation-for="Input.Country" class="text-danger"></span>
        </div>

        <div class="col-12">
            <button type="submit" id="btnRegister" class="btn btn-primary" disabled>Register</button>
            <a asp-page="/Index" class="btn btn-outline-secondary">Cancel</a>
            <a asp-page="/Auth/Login" class="btn btn-link">Already have an account? Login</a>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        (function () {
            const form = document.getElementById('registerForm');
            const btn  = document.getElementById('btnRegister');
            if (!form || !btn) return;

            const inputs = Array.from(form.querySelectorAll('input, select, textarea'));

            function isFilled(el) {
                if (el.disabled || el.type === 'hidden') return true;
                if (el.tagName === 'SELECT') return el.value && el.value.trim() !== '';
                if (el.type === 'checkbox' || el.type === 'radio') {
                    const group = form.querySelectorAll(`input[name="${el.name}"]`);
                    return Array.from(group).some(i => i.checked);
                }
                return el.value && el.value.trim() !== '';
            }

            function update() {
                const filled = inputs.every(isFilled);
                const valid  = form.checkValidity ? form.checkValidity() : true;
                btn.disabled = !(filled && valid);
            }

            inputs.forEach(el => {
                el.addEventListener('input', update);
                el.addEventListener('change', update);
            });

            update();
        })();
    </script>
}
